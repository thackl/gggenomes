<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>From a few sequences to a complex map in minutes (old version) • gggenomes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="From a few sequences to a complex map in minutes (old version)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gggenomes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gggenomes.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/emales.html">From a few sequences to a complex map in minutes (old version)</a></li>
    <li><a class="dropdown-item" href="../articles/flip.html">Advanced flip examples</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thackl/gggenomes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>From a few sequences to a complex map in minutes (old version)</h1>
                        <h4 data-toc-skip class="author">Thomas
Hackl</h4>
            
            <h4 data-toc-skip class="date">2025-01-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thackl/gggenomes/blob/master/vignettes/emales.Rmd" class="external-link"><code>vignettes/emales.Rmd</code></a></small>
      <div class="d-none name"><code>emales.Rmd</code></div>
    </div>

    
    
<p><strong>DISCLAIMER: I’ve created this demo with an early version of
gggenomes. Not all of the code will function with current releases.
However, the general workflow both with respect to the external tools
and gggenomes code is still valid and this demo should therefore be
understood as an hopefully inspiring guide - not as an exactly
reproducible code example (Those kind of examples you can find in the
examples sections of the documentation).</strong></p>
<p>This is a real-life example demonstrating the use of
<code>gggenomes</code> to explore viral genomes. We start with just a
bunch of viral contigs and ask: Is there anything interesting going on
here?</p>
<p>We use a few bioinformatics commandline tools to run some analyzes,
and visualize the results using <code>gggenomes</code>. By successively
adding new data as new tracks we build a rich plot that ultimatly
reveals novel insights into an exciting system.</p>
<p>This example is bundled <code>data(package="gggenomes")</code> To
rerun the this example including the bioinformatics analyzes download
the <a href="https://github.com/thackl/gggenomes/raw/master/data-raw/emales.tgz" class="external-link">raw
data</a> from github.</p>
<p><img src="emales%2Females-p7.png"></p>
<div class="section level3">
<h3 id="read-in-the-genomes">Read in the genomes<a class="anchor" aria-label="anchor" href="#read-in-the-genomes"></a>
</h3>
<p>We start with a fasta file of 33 viral genomes. We read sequence
length and some metadata from the header lines using
`read<sub>fai</sub>`…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://thackl.github.io/gggenomes/">gggenomes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parse sequence length and some metadata from fasta file</span></span>
<span><span class="va">emale_seqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_seq_len.html">read_fai</a></span><span class="op">(</span><span class="st">"emales.fna"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">seq_desc</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"emale_type"</span>, <span class="st">"is_typespecies"</span><span class="op">)</span>, <span class="st">"=(\\S+) \\S+=(\\S+)"</span>,</span>
<span>    remove<span class="op">=</span><span class="cn">F</span>, convert<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">emale_type</span>, <span class="va">length</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the genomes - first six only to keep it simple for this example</span></span>
<span><span class="va">emale_seqs_6</span> <span class="op">&lt;-</span> <span class="va">emale_seqs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="emales%2Females-p1.png"></p>
</div>
<div class="section level3">
<h3 id="annotate-genes">Annotate genes<a class="anchor" aria-label="anchor" href="#annotate-genes"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># https://github.com/thackl/seq-scripts</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">seq-join</span> <span class="at">-n</span> emales-concat <span class="op">&lt;</span> emales.fna <span class="op">&gt;</span> emales-concat.fna                       </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># Annotate genes | https://github.com/hyattpd/Prodigal</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">prodigal</span> <span class="at">-n</span> <span class="at">-t</span> emales-prodigal.train <span class="at">-i</span> emales-concat.fna                                 </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="ex">prodigal</span> <span class="at">-t</span> emales-prodigal.train <span class="at">-i</span> emales.fna <span class="at">-o</span> emales-prodigal.gff <span class="at">-f</span> gff</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># A little help to clean up the prodigal gff | https://github.com/thackl/seq-scripts</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="ex">gff-clean</span> emales-prodigal.gff <span class="op">&gt;</span> emales.gff</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emale_genes</span> <span class="op">&lt;-</span> <span class="fu">read_gff</span><span class="op">(</span><span class="st">"emales.gff"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>feature_id<span class="op">=</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                       <span class="co"># we'll need this later</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gc_cont<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">gc_cont</span><span class="op">)</span><span class="op">)</span>             <span class="co"># per gene GC-content</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span>, <span class="va">emale_genes</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_gene.html">geom_gene</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">gc_cont</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="emales%2Females-p2.png"></p>
</div>
<div class="section level3">
<h3 id="find-terminal-inverted-repeats">Find terminal inverted repeats<a class="anchor" aria-label="anchor" href="#find-terminal-inverted-repeats"></a>
</h3>
<p>It is known that these type of viruses often have linear genomes with
terminal inverted repeats (TIRs). So let’s look for those next.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># split into one genome per file | https://bioinf.shenwei.me/seqkit/</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">seqkit</span> split <span class="at">-i</span> emales.fna  </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># self-align opposite strands                        </span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="cf">for</span> fna <span class="kw">in</span> <span class="kw">`</span><span class="fu">ls</span> emales.fna.split/<span class="pp">*</span>.fna<span class="kw">`;</span> <span class="cf">do</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="ex">minimap2</span> <span class="at">-c</span> <span class="at">-B5</span> <span class="at">-O6</span> <span class="at">-E3</span> <span class="at">--rev-only</span> <span class="va">$fna</span> <span class="va">$fna</span> <span class="op">&gt;</span> <span class="va">$fna</span>.paf<span class="kw">;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="cf">done</span><span class="kw">;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="fu">cat</span> emales.fna.split/<span class="pp">*</span>.paf <span class="op">&gt;</span> emales-tirs.paf</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prefilter hits by minimum length and maximum divergence</span></span>
<span><span class="va">emale_tirs_paf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_paf.html">read_paf</a></span><span class="op">(</span><span class="st">"emales-tirs.paf"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">seq_id1</span> <span class="op">==</span> <span class="va">seq_id2</span> <span class="op">&amp;</span> <span class="va">start1</span> <span class="op">&lt;</span> <span class="va">start2</span> <span class="op">&amp;</span> <span class="va">map_length</span> <span class="op">&gt;</span> <span class="fl">99</span> <span class="op">&amp;</span> <span class="va">de</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">emale_tirs</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">emale_tirs_paf</span>, seq_id<span class="op">=</span><span class="va">seq_id1</span>, start<span class="op">=</span><span class="va">start1</span>, end<span class="op">=</span><span class="va">end1</span>, <span class="va">de</span><span class="op">)</span>,</span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">emale_tirs_paf</span>, seq_id<span class="op">=</span><span class="va">seq_id2</span>, start<span class="op">=</span><span class="va">start2</span>, end<span class="op">=</span><span class="va">end2</span>, <span class="va">de</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span>, <span class="va">emale_genes</span>, <span class="va">emale_tirs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_gene.html">geom_gene</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">gc_cont</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span></span>
<span><span class="va">p3</span></span></code></pre></div>
<p><img src="emales%2Females-p3.png"></p>
</div>
<div class="section level3">
<h3 id="compare-genome-synteny">Compare genome synteny<a class="anchor" aria-label="anchor" href="#compare-genome-synteny"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># All-vs-all alignment | https://github.com/lh3/minimap2</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">minimap2</span> <span class="at">-X</span> <span class="at">-N</span> 50 <span class="at">-p</span> 0.1 <span class="at">-c</span> emales.fna emales.fna <span class="op">&gt;</span> emales.paf</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emale_links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_paf.html">read_paf</a></span><span class="op">(</span><span class="st">"emales.paf"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span>, <span class="va">emale_genes</span>, <span class="va">emale_tirs</span>, <span class="va">emale_links</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span>, data<span class="op">=</span><span class="fu">use_features</span><span class="op">(</span><span class="va">features</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_gene.html">geom_gene</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">gc_cont</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_link.html">geom_link</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">p4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">flip_bins</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">p4</span></span></code></pre></div>
<p><img src="emales%2Females-p4.png"></p>
</div>
<div class="section level3">
<h3 id="gc-content">GC-content<a class="anchor" aria-label="anchor" href="#gc-content"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># https://github.com/thackl/seq-scripts (bedtools &amp; samtools)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">seq-gc</span> <span class="at">-Nbw</span> 50 emales.fna <span class="op">&gt;</span> emales-gc.tsv</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emale_gc</span> <span class="op">&lt;-</span> <span class="fu">thacklr</span><span class="fu">::</span><span class="fu">read_bed</span><span class="op">(</span><span class="st">"emales-gc.tsv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>seq_id<span class="op">=</span><span class="va">contig_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">p4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="va">xend</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, ymax<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.24</span>, ymin<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.38</span><span class="op">-</span><span class="op">(</span><span class="fl">.4</span><span class="op">*</span><span class="va">score</span><span class="op">)</span>,</span>
<span>    group<span class="op">=</span><span class="va">seq_id</span>, linetype<span class="op">=</span><span class="st">"GC-content"</span><span class="op">)</span>, <span class="fu">use_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span>,</span>
<span>                       fill<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span>
<span><span class="va">p5</span></span></code></pre></div>
<p><img src="emales%2Females-p5.png"></p>
</div>
<div class="section level3">
<h3 id="cluster-protein-sequences-into-orthogroups">cluster protein sequences into orthogroups<a class="anchor" aria-label="anchor" href="#cluster-protein-sequences-into-orthogroups"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">gff2cds</span> <span class="at">--aa</span> <span class="at">--type</span> CDS <span class="at">--source</span> Prodigal_v2.6.3 <span class="at">--fna</span> emales.fna emales.gff <span class="op">&gt;</span> emales.faa</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">mmseqs</span> easy-cluster emales.faa emales-mmseqs /tmp <span class="at">-e</span> 1e-5 <span class="at">-c</span> 0.7<span class="kw">;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">cluster-ids</span> <span class="at">-t</span> <span class="st">"cog%03d"</span> <span class="op">&lt;</span> emales-mmseqs_cluster.tsv <span class="op">&gt;</span> emales-cogs.tsv</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emale_cogs</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"emales-cogs.tsv"</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feature_id"</span>, <span class="st">"cluster_id"</span>, <span class="st">"cluster_n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">emale_cogs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  cluster_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cluster_id</span>, <span class="st">" ("</span>, <span class="va">cluster_n</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>  cluster_label <span class="op">=</span> <span class="fu">fct_lump_min</span><span class="op">(</span><span class="va">cluster_label</span>, <span class="fl">5</span>, other_level <span class="op">=</span> <span class="st">"rare"</span><span class="op">)</span>,</span>
<span>  cluster_label <span class="op">=</span> <span class="fu">fct_lump_min</span><span class="op">(</span><span class="va">cluster_label</span>, <span class="fl">15</span>, other_level <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span>,</span>
<span>  cluster_label <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">cluster_label</span>, <span class="st">"rare"</span>, after<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">emale_cogs</span></span>
<span></span>
<span></span>
<span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span>, <span class="va">emale_genes</span>, <span class="va">emale_tirs</span>, <span class="va">emale_links</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_tracks.html">add_clusters</a></span><span class="op">(</span><span class="va">genes</span>, <span class="va">emale_cogs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">flip_bins</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span>, data<span class="op">=</span><span class="fu">use_features</span><span class="op">(</span><span class="va">features</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_gene.html">geom_gene</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">cluster_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_link.html">geom_link</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="va">xend</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, ymax<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.24</span>, ymin<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.38</span><span class="op">-</span><span class="op">(</span><span class="fl">.4</span><span class="op">*</span><span class="va">score</span><span class="op">)</span>,</span>
<span>    group<span class="op">=</span><span class="va">seq_id</span>, linetype<span class="op">=</span><span class="st">"GC-content"</span><span class="op">)</span>, <span class="fu">use_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span>,</span>
<span>                       fill<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="st">"Conserved genes"</span>, palette<span class="op">=</span><span class="st">"Set3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p6</span></span></code></pre></div>
<p><img src="emales%2Females-p6.png"></p>
</div>
<div class="section level3">
<h3 id="blast-hits-and-integrated-transposons">Blast hits and integrated transposons<a class="anchor" aria-label="anchor" href="#blast-hits-and-integrated-transposons"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># mavirus.faa - published</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">blastp</span> <span class="at">-query</span> emales.faa <span class="at">-subject</span> mavirus.faa <span class="at">-outfmt</span> 7 <span class="op">&gt;</span> emales_mavirus-blastp.tsv</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">perl</span> <span class="at">-ne</span> <span class="st">'if(/&gt;(\S+) gene=(\S+) product=(.+)/){print join("\t", $1, $2, $3), "\n"}'</span> <span class="dt">\</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  mavirus.faa <span class="op">&gt;</span> mavirus.tsv</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emale_blast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_blast.html">read_blast</a></span><span class="op">(</span><span class="st">"emales_mavirus-blastp.tsv"</span><span class="op">)</span></span>
<span><span class="va">emale_blast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">evalue</span> <span class="op">&lt;</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>feature_id<span class="op">=</span><span class="va">qaccver</span>, start<span class="op">=</span><span class="va">qstart</span>, end<span class="op">=</span><span class="va">qend</span>, <span class="va">saccver</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">read_tsv</span><span class="op">(</span><span class="st">"mavirus.tsv"</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"saccver"</span>, <span class="st">"blast_hit"</span>, <span class="st">"blast_desc"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># manual annotations by MFG</span></span>
<span><span class="va">emale_transposons</span> <span class="op">&lt;-</span> <span class="fu">read_gff</span><span class="op">(</span><span class="st">"emales-manual.gff"</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mobile_element"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gggenomes.html">gggenomes</a></span><span class="op">(</span><span class="va">emale_seqs_6</span>, <span class="va">emale_genes</span>, <span class="va">emale_tirs</span>, <span class="va">emale_links</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_tracks.html">add_clusters</a></span><span class="op">(</span><span class="va">genes</span>, <span class="va">emale_cogs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_features</span><span class="op">(</span><span class="va">emale_transposons</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_subfeatures</span><span class="op">(</span><span class="va">genes</span>, <span class="va">emale_blast</span>, transform<span class="op">=</span><span class="st">"aa2nuc"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">flip_bins</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"integrated transposon"</span><span class="op">)</span>,</span>
<span>    <span class="fu">use_features</span><span class="op">(</span><span class="va">emale_transposons</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_seq.html">geom_seq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/geom_bin_label.html">geom_bin_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_link.html">geom_link</a></span><span class="op">(</span>offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"white"</span>, alpha<span class="op">=</span><span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"terminal inverted repeat"</span><span class="op">)</span>, <span class="fu">use_features</span><span class="op">(</span><span class="va">features</span><span class="op">)</span>,</span>
<span>    size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_gene.html">geom_gene</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">cluster_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_feature</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">blast_desc</span><span class="op">)</span>, <span class="fu">use_features</span><span class="op">(</span><span class="va">emale_blast</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span>,</span>
<span>    position<span class="op">=</span><span class="st">"pile"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="va">xend</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, ymax<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.24</span>, ymin<span class="op">=</span><span class="va">y</span><span class="op">+</span><span class="fl">.38</span><span class="op">-</span><span class="op">(</span><span class="fl">.4</span><span class="op">*</span><span class="va">score</span><span class="op">)</span>,</span>
<span>    group<span class="op">=</span><span class="va">seq_id</span>, linetype<span class="op">=</span><span class="st">"GC-content"</span><span class="op">)</span>, <span class="fu">use_features</span><span class="op">(</span><span class="va">emale_gc</span><span class="op">)</span>,</span>
<span>                       fill<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="st">"Conserved genes"</span>, palette<span class="op">=</span><span class="st">"Set3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="st">"Blast hits &amp; Features"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype</a></span><span class="op">(</span><span class="st">"Graphs"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Endogenous mavirus-like elements of "</span>,</span>
<span>  <span class="fu">italic</span><span class="op">(</span><span class="st">"C. burkhardae"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p7</span></span></code></pre></div>
<p><img src="emales%2Females-p7.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Hackl, Markus J. Ankenbrand, Bart van Adrichem.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
